(()=>{"use strict";console.log("Иван Айвазовский");const t=new class{constructor(){this.string={en:{resetBtn:"new game",gemPuzzle:"gem-puzzle",startBtn:"start",stopBtn:"pause",saveBtn:"save",loadBtn:"load",bestResBtn:"results",soundBtn:"sound ON",soundBtnOFF:"sound OFF",stepBtn:"auto",step:"step: "},ru:{resetBtn:"заново",gemPuzzle:"пятнашки",stopBtn:"пауза",startBtn:"начать",saveBtn:"сохранить",loadBtn:"загрузить",bestResBtn:"результаты",soundBtn:"звук ВКЛ",soundBtnOFF:"звук ВЫВКЛ",stepBtn:"авто",step:"шаг: "}},this.lang="ru",this.mainEl=null,this.mainContainer=null,this.innerEl=null,this.el=null,this.tempLog="",this.tempLogBR="\n",this.sattingsBoardContainer=null,this.gameBoardContainer=null,this.dashBoardContainer=null,this.timer=null,this.timerVal=null,this.isPaused=!0,this.stopStartBtn=null,this.timerID=null,this.step=0,this.stepCounterObj=null,this.solvingHint=null,this.winHint=null,this.matrixDimensionX=null,this.matrixDimensionY=null,this.mainElNum=null,this.defaultDimension=8,this.dem={mobile:{2:160,3:106,4:80,5:64,6:53,7:45,8:40},tablet:{2:218,3:146,4:109,5:87,6:73,7:63,8:55},desktop:{2:218,3:146,4:109,5:87,6:73,7:63,8:55}},this.isMobile=!1,this.initIsMobile(),this.setDimentionXY(),this.setMainElNum(),this.offset=null,this.setOffset(),this.matrix=[],this.shuffledMatrix=[],this.stepMatrix=[],this.shuffledMatrixEvenSumm=0,this.stepBtn=null,this.bestResBtnObj=null,this.soundBtn=null,this.soundObj=null,this.isSound=!0,this.autoStepSpeed=800,this.isAutoMode=!1,this.autoFnID=null,this.styleSheet=null,this.setStyleSheet(),this.img={imagesPath:"",imagesAmount:150,images:{}}}checkShuffledMatrix(){let t=!0;return this.shuffledMatrix.forEach(((e,s)=>{this.getCurrentElNum(e)!==s+1&&(t=!1)})),t}makeAISteps(){let t,e=0,s=1,i=16;const o=this;this.setCurrentMatrixN(),this.autoFnID=setInterval((()=>{0===e&&(console.log("element: "+i),o.stepsCompute(i,s),t=o.stepMatrix.length),0===o.stepMatrix.length&&(e=t),o.isAutoMode||(clearInterval(o.autoFnID),o.stepMatrix=[],console.log("end")),e===t?(s+=1,this.stepMatrix=[],e=0,s>3&&(16!==i?(i+=1,s=1):(clearInterval(o.autoFnID),o.isAutoMode=!1,console.log("end")))):(e+=1,0!==o.stepMatrix.length&&(console.log(`${o.stepMatrix[e-1][0]} ${this.tempGetDirection(o.stepMatrix[e-1][1])}`),o.makeStep(o.stepMatrix[e-1][1],o.stepMatrix[e-1][0])))}),this.autoStepSpeed)}tempGetDirection(t){switch(t){case 1:return"TOP";case 2:return"RIGHT";case 3:return"BOTTOM";case 4:return"LEFT"}return!1}initIsMobile(){(window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth)<480&&(this.isMobile=!0)}getBackGroundSize(){return this.getOffset()*this.matrixDimensionX}getBackGroundSizeCSS(){const t=this.getBackGroundSize();return`background-size: ${t}px ${t}px;`}setOffset(){this.offset=this.isMobile?this.dem.mobile[this.matrixDimensionX]:this.dem.desktop[this.matrixDimensionX]}getOffset(){return this.offset}isElOnItsTopRow(t){return this.isElOnPropPosY(t)}isElOnItsLeftCol(t){return this.isElOnPropPosX(t)}getBoxElNumViaCurrElNum(t){return this.getElNumViaLeftTopPos(this.getPosX(t),this.getPosY(t))}getCurrentElNumN(t){return parseInt(this.getPosX(t)/this.getOffset(),10)+1+parseInt(this.getPosY(t)/this.getOffset(),10)*this.matrixDimensionY}setCurrentMatrixN(){Object.keys(this.matrix).forEach(((t,e)=>{this.shuffledMatrix[this.getCurrentElNumN(e+1)-1]=e+1}))}setShffldOnElNumAndGooo(t,e=-1){let s=0;this.shuffledMatrix.forEach(((i,o)=>{i===t&&0===s?this.shuffledMatrix[o+e]&&(this.shuffledMatrix[o]=this.shuffledMatrix[o+e],this.shuffledMatrix[o+e]=i,s++):this.shuffledMatrix[o]=i})),this.shuffle("notShuffle")}getCountOfStepsToPropYPos(t){return this.matrix[t-1].y/this.getOffset()-this.getYInitElementPosInsidMatrix(t)}toTop(t){if(this.setMElAbove(t),0===this.stepMatrix.length)return;let e=this.getCountOfStepsToPropYPos(t)-1;for(this.addStep(t,1);e>0;)this.isElLastOnRow(t)?(console.log("laaaaast el!"),this.goMountOfSteps("left",1),this.goMountOfSteps("top",2),this.goMountOfSteps("right",1)):(this.goMountOfSteps("right",1),this.goMountOfSteps("top",2),this.goMountOfSteps("left",1)),this.addStep(t,1),e--;this.isItPreLastElInRow(t)&&(console.log("posiiiiition isItPreLastElInRow"),this.goMountOfSteps("right",1),this.goMountOfSteps("top",1),this.addStep(t,2))}setMElAbove(t){if(console.log("set MEl Under"),this.isMElBefore(t)){if(this.matrix[t-1].x<=this.getXPXPosition(t)&&this.matrix[t-1].y-this.getOffset()===this.getYPXPosition(t))return void(this.stepsToRight(t)>=0&&(console.log("special case (set MEl Under)"),this.goMountOfSteps("right",this.getMountOfSteps(t,"right")-1),this.goMountOfSteps("bottom",1),this.goMountOfSteps("right",2),this.goMountOfSteps("top",2),this.goMountOfSteps("left",1)));if(this.isMElOnTheSameRow(t))return void(this.stepsToRight(t)>=0&&(console.log("on the same row (set MEl Under)"),this.goMountOfSteps("right",this.getMountOfSteps(t,"right")-1),this.goMountOfSteps("top",1),this.goMountOfSteps("right",1)));console.log("1st 2nd part (set MEl Under)"),this.stepsToBottom(t)>0&&this.goMountOfSteps("bottom",this.getMountOfSteps(t,"bottom")-1),this.stepsToRight(t)>=0&&this.goMountOfSteps("right",this.getMountOfSteps(t,"right")),this.stepsToLeft(t)>=0&&this.goMountOfSteps("left",this.getMountOfSteps(t,"left"))}else{if(this.isMElOnTheSameRow(t))return void(this.stepsToLeft(t)>=0&&(this.goMountOfSteps("left",this.getMountOfSteps(t,"left")-1),this.goMountOfSteps("top",1),this.goMountOfSteps("left",1)));if(this.isMElOnTheSameCol(t))return void(this.isMElCanMoveToTheRight()?(this.goMountOfSteps("right",1),this.goMountOfSteps("top",this.getMountOfSteps(t,"top")+1),this.goMountOfSteps("left",1)):(this.goMountOfSteps("left",1),this.goMountOfSteps("top",this.getMountOfSteps(t,"top")+1),this.goMountOfSteps("right",1)));if(this.matrix[t-1].x<=this.getXPXPosition(t)&&this.matrix[t-1].y-this.getOffset()===this.getYPXPosition(t))return this.stepsTotop(t)>=0&&this.goMountOfSteps("top",this.getMountOfSteps(t,"top")-1),this.stepsToRight(t)>=0&&this.goMountOfSteps("right",this.getMountOfSteps(t,"right")),this.stepsToLeft(t)>=0&&this.goMountOfSteps("left",this.getMountOfSteps(t,"left")),this.goMountOfSteps("right",1),this.goMountOfSteps("top",2),void this.goMountOfSteps("left",1);this.stepsTotop(t)>=0&&this.goMountOfSteps("top",this.getMountOfSteps(t,"top")-1),this.stepsToRight(t)>=0&&this.goMountOfSteps("right",this.getMountOfSteps(t,"right")),this.stepsToLeft(t)>=0&&this.goMountOfSteps("left",this.getMountOfSteps(t,"left")),this.goMountOfSteps("left",1),this.goMountOfSteps("top",2),this.goMountOfSteps("right",1)}}getCountOfStepsToPropXPos(t){return this.matrix[t-1].x/this.getOffset()-this.getXInitElementPosInsideMatrix(t)}toLeft(t){if(console.log("set MEl Before"),this.setMElBefore(t),0===this.stepMatrix.length)return;let e=this.getCountOfStepsToPropXPos(t)-1;for(console.log(`(${this.matrix[t-1].x} / ${this.getOffset()}) - ${this.getXInitElementPosInsideMatrix(t)} = ${e}`),this.addStep(t,4);e>0;)console.log("countOfStepsToPropXPos: ----\x3e "+e),console.log("countOfStepsToPropXPos: 999 "+(e>0)),this.isThereAbilityToGoByBottom(t)?(this.goMountOfSteps("bottom",1),this.goMountOfSteps("left",2),this.goMountOfSteps("top",1)):(this.goMountOfSteps("top",1),this.goMountOfSteps("left",2),this.goMountOfSteps("bottom",1)),this.addStep(t,4),e--}isElBeforeItsPropRow(t){return this.matrix[t-1].x<this.getXPXPosition(t)}setMElBefore(t){if(this.isElOnPropPosX(t))return console.log("isElOnPropPosX "+this.isElOnPropPosX(t)),!1;if(this.isElBeforeItsPropRow(t))return console.log(t+" El Before Its Prop Row"),!1;let e=!1;if(this.isMElBefore(t)){if(this.isMElOnTheSameRow(t)&&this.stepsToRight(t)>=0)return this.goMountOfSteps("right",this.getMountOfSteps(t,"right")-1),!0;if(this.isMElOnTheSameCol(t)&&this.stepsToBottom(t)>=0)return this.goMountOfSteps("bottom",this.getMountOfSteps(t,"bottom")-1),this.goMountOfSteps("left",1),this.goMountOfSteps("bottom",1),!0;this.stepsToBottom(t)>=0?(this.goMountOfSteps("bottom",this.getMountOfSteps(t,"bottom")-1),this.stepsToRight(t)>=0&&this.goMountOfSteps("right",this.getMountOfSteps(t,"right")-1),this.stepsToLeft(t)>=0&&this.goMountOfSteps("left",this.getMountOfSteps(t,"left")+1),this.goMountOfSteps("bottom",1),e=!0):(this.stepsToRight(t)>=0&&this.goMountOfSteps("right",this.getMountOfSteps(t,"right")-1),this.stepsToLeft(t)>=0&&this.goMountOfSteps("left",this.getMountOfSteps(t,"left")+1),this.stepsToBottom(t)>=0&&this.goMountOfSteps("bottom",this.getMountOfSteps(t,"bottom")))}else{if(this.isMElOnTheSameRow(t))return void(this.isMElCanMoveToTheBottom()?(this.goMountOfSteps("bottom",1),this.goMountOfSteps("left",this.getMountOfSteps(t,"left")+1),this.goMountOfSteps("top",1)):(this.goMountOfSteps("top",1),this.goMountOfSteps("left",this.getMountOfSteps(t,"left")+1),this.goMountOfSteps("bottom",1)));if(this.isMElOnTheSameCol(t))return this.goMountOfSteps("left",1),void this.goMountOfSteps("top",this.getMountOfSteps(t,"top"));this.stepsToRight(t)>=0&&this.goMountOfSteps("right",this.getMountOfSteps(t,"right")-1),this.stepsToLeft(t)>=0&&this.goMountOfSteps("left",this.getMountOfSteps(t,"left")+1),this.stepsTotop(t)>=0&&this.goMountOfSteps("top",this.getMountOfSteps(t,"top"))}return e}isElLastOnRow(t){return this.getXInitElementPosInsideMatrix(t)+1===this.matrixDimensionX}isItPreLastElInRow(t){return this.getXInitElementPosInsideMatrix(t)+1===this.matrixDimensionX-1}toRight(t){if(console.log("set MEl After"),!this.setMElAfter(t))return;let e=-1*this.getCountOfStepsToPropXPos(t)-1;for(this.addStep(t,2);e>0;)this.isThereAbilityToGoByBottom(t)?(console.log("isThereAbilityToGoByBottom: "+this.isThereAbilityToGoByBottom(t)),this.goMountOfSteps("bottom",1),this.goMountOfSteps("right",2),this.goMountOfSteps("top",1)):(console.log("isThereAbilityToGoByBottom: "+this.isThereAbilityToGoByBottom(t)),this.goMountOfSteps("top",1),this.goMountOfSteps("right",2),this.goMountOfSteps("bottom",1)),this.addStep(t,2),e--}isCaseRangedRowAbove(t){return this.matrix[t-1].x<=this.getXPXPosition(t)&&this.matrix[t-1].y-this.getOffset()===this.getYPXPosition(t)}setMElAfter(t){if(this.isElOnPropPosX(t))return!1;if(!this.isElBeforeItsPropRow(t))return console.log(`isElNOTBeforeItsPropRow ${!this.isElBeforeItsPropRow(t)} - EXIT FROM setMElAfter`),!1;let e=!1;if(this.isMElBefore(t)){if(this.isCaseRangedRowAbove(t))return console.log("case when ranged row is above"),this.stepsToRight(t)>=0&&(this.goMountOfSteps("right",this.getMountOfSteps(t,"right")-1),this.goMountOfSteps("bottom",1),this.goMountOfSteps("right",2),this.goMountOfSteps("top",2)),this.stepsToLeft(t)>=0&&(this.goMountOfSteps("bottom",1),this.goMountOfSteps("left",this.getMountOfSteps(t,"left")-1)),!0;if(this.isMElOnTheSameRow(t)&&this.stepsToRight(t)>=0)return console.log("МЭЛ на одной строке и перед эл"),this.goMountOfSteps("right",this.getMountOfSteps(t,"right")-1),this.goMountOfSteps("top",1),this.goMountOfSteps("right",2),this.goMountOfSteps("bottom",1),!0;if(this.stepsToBottom(t)>=0&&(this.goMountOfSteps("bottom",this.getMountOfSteps(t,"bottom")-1),e=!0),this.isMElOnTheSameCol(t))return this.goMountOfSteps("right",1),this.goMountOfSteps("bottom",1),!0;this.stepsToRight(t)>=0&&(this.goMountOfSteps("right",this.getMountOfSteps(t,"right")+1),console.log("testing ------------"),this.goMountOfSteps("bottom",1),e=!0),this.stepsToLeft(t)>=0&&(this.goMountOfSteps("left",this.getMountOfSteps(t,"left")-1),this.goMountOfSteps("bottom",1),e=!0)}else{if(this.isMElOnTheSameRow(t)&&this.stepsToLeft(t)>=0)return this.goMountOfSteps("left",this.getMountOfSteps(t,"left")-1),!0;if(this.isMElOnTheSameCol(t)&&this.isMElCanMoveToTheRight())return this.goMountOfSteps("right",1),this.goMountOfSteps("top",this.getMountOfSteps(t,"top")),!0;this.stepsTotop(t)>=0&&(this.goMountOfSteps("top",this.getMountOfSteps(t,"top")-1),e=!0),this.stepsToRight(t)>=0&&(this.goMountOfSteps("right",this.getMountOfSteps(t,"right")),e=!0),this.stepsToLeft(t)>=0&&(this.goMountOfSteps("left",this.getMountOfSteps(t,"left")),e=!0),e&&(this.goMountOfSteps("right",1),this.goMountOfSteps("top",1))}return e}addStep(t,e){this.stepMatrix.push([t,e])}makeStep(t,e=this.mainElNum){switch(t){case 1:case"top":this.setShffldOnElNumAndGooo(e,-1*this.matrixDimensionX);break;case 2:case"right":this.setShffldOnElNumAndGooo(e,1);break;case 3:case"bottom":this.setShffldOnElNumAndGooo(e,this.matrixDimensionX);break;case 4:case"left":if(e!==this.mainElNum&&this.isDrggblToLeft(e)){this.setShffldOnElNumAndGooo(e);break}this.setShffldOnElNumAndGooo(e)}}getMountOfSteps(t,e){switch(e){case"top":return this.getElRowNum(this.mainElNum)-this.getElRowNum(t);case"right":return this.getElColNum(t)-this.getElColNum(this.mainElNum);case"bottom":return this.getElRowNum(t)-this.getElRowNum(this.mainElNum);case"left":return this.getElColNum(this.mainElNum)-this.getElColNum(t);default:return!1}}goMountOfSteps(t,e){for(let s=0;s<e;s++)switch(t){case"top":this.addStep(this.mainElNum,1);break;case"right":this.addStep(this.mainElNum,2);break;case"bottom":this.addStep(this.mainElNum,3);break;case"left":this.addStep(this.mainElNum,4)}}getElRowNum(t){return this.matrix[t-1].y/this.getOffset()+1}getElColNum(t){return this.matrix[t-1].x/this.getOffset()+1}isMElBefore(t){return this.getCurrentElNumN(this.mainElNum)<this.getCurrentElNumN(t)}isOnPropRow(t){return this.isElOnPropPosY(t)}isOnPropCol(t){return this.isElOnPropPosX(t)}isMElOnTheSameRow(t){return this.matrix[this.mainElNum-1].y===this.matrix[t-1].y}isMElOnTheSameCol(t){return this.matrix[this.mainElNum-1].x===this.matrix[t-1].x}isMElCanMoveToTheRight(){return this.getCurrentElNumN(this.mainElNum)%this.matrixDimensionX!=0}isMElCanMoveToTheLeft(){return(this.getCurrentElNumN(this.mainElNum)-1)%this.matrixDimensionX!=0}isMElCanMoveToTheTop(){return 0!==this.matrix[this.mainElNum-1].y}isMElCanMoveToTheBottom(){return this.matrix[this.mainElNum-1].y<(this.matrixDimensionY-1)*this.getOffset()}isThereAbilityToGoByBottom(t){return this.matrix[t-1].y<(this.matrixDimensionY-1)*this.getOffset()}isDrggblToTop(t){return this.isElMain(this.getTopElNum(t))}isDrggblToBottom(t){return this.isElMain(this.getBottomElNum(t))}isDrggblToLeft(t){return this.isElMain(this.getLeftElNum(t))}isDrggblToRight(t){return this.isElMain(this.getRightElNum(t))}stepsToBottom(t){return this.getMountOfSteps(t,"bottom")-1}stepsTotop(t){return this.getMountOfSteps(t,"top")-1}stepsToRight(t){return this.getMountOfSteps(t,"right")-1}stepsToLeft(t){return this.getMountOfSteps(t,"left")-1}stepsCompute(t,e){if(this.mainElNum!==t&&(this.setCurrentMatrixN(),!this.isElOnPropPos(t)))switch(e){case 1:console.log("case 1 LEFT"),this.toLeft(t);break;case 2:console.log("case 2 RIGHT"),this.toRight(t);break;case 3:console.log("case 3 TOP"),this.toTop(t)}}araseMatrix(){this.matrix=[]}setDimentionXY(t){this.matrixDimensionX=t||this.defaultDimension,this.matrixDimensionY=t||this.defaultDimension,this.setMainElNum()}getElObj(t){return{x:this.getXPXPosition(t),y:this.getYPXPosition(t),ownNum:t,isMain:t===this.getMatrixDimension()}}getXInitElementPosInsideMatrix(t){return(t-1)%this.matrixDimensionX}getYInitElementPosInsidMatrix(t){return parseInt((t-1)/this.matrixDimensionX,10)}getYPXPosition(t){return this.getYInitElementPosInsidMatrix(t)*this.getOffset()}getXPXPosition(t){return this.getXInitElementPosInsideMatrix(t)*this.getOffset()}setPosY(t,e){this.matrix[t-1].y=e}setPosX(t,e){this.matrix[t-1].x=e}setMatrixDimensionX(t){this.matrixDimensionX=t}getMatrixDimension(){return this.matrixDimensionX*this.matrixDimensionY}setMainElNum(){this.mainElNum=this.getMatrixDimension()}getMainElID(){return"elID_"+this.mainElNum}addElObjToMatrix(t){this.matrix.push(this.getElObj(t))}makeShuffledMatrix(){for(let t=1,e=this.getMatrixDimension();t<=e;t++)this.shuffledMatrix.push(t);this.shuffledMatrix.sort((()=>Math.random()-.5))}makeAllObj(){this.makeShuffledMatrix();for(let t=1,e=this.getMatrixDimension();t<=e;t++)this.addElObjToMatrix(t)}getElLeftTopCSSProp(t){return`left: ${this.getXPXPosition(t)}px; top: ${this.getYPXPosition(t)}px;`}getElBgPosCSSProp(t){return`${this.getBackGroundSizeCSS()} background-position: -${this.getXPXPosition(t)}px -${this.getYPXPosition(t)}px;`}isElMain(t){return!!t&&this.matrix[t-1].isMain}getElNumViaLeftTopPos(t,e){try{return this.matrix.find((s=>s.x===t&&s.y===e)).ownNum}catch(t){return!1}}getPosX(t){return this.matrix[t-1].x}getPosY(t){return this.matrix[t-1].y}getTopElNum(t){return this.getElNumViaLeftTopPos(this.getPosX(t),this.getPosY(t)-this.getOffset())}getRightElNum(t){return this.getElNumViaLeftTopPos(this.getPosX(t)+this.getOffset(),this.getPosY(t))}getBottomElNum(t){return this.getElNumViaLeftTopPos(this.getPosX(t),this.getPosY(t)+this.getOffset())}getLeftElNum(t){return this.getElNumViaLeftTopPos(this.getPosX(t)-this.getOffset(),this.getPosY(t))}render(){this.makeNoMatrixElmnts(),this.showMatrix(),this.mainUsrController()}startTimer(){this.isPaused=!1;const t=!!this.getTimerVal()&&this.getTimerVal().split(":");let e=t?parseInt(t[2],10):0,s=t?parseInt(t[1],10):0,i=t?parseInt(t[0],10):0;const o=this.timer;this.timerID=setInterval((()=>{e+=1,e>=60&&(s+=1,e=0),s>=60&&(i+=1,s=0),o.innerText=`${i.toString().length<2?"0"+i:i}:${s.toString().length<2?"0"+s:s}:${e.toString().length<2?"0"+e:e}`}),1e3)}getTimerVal(){return this.timerVal}setTimerVal(){this.timerVal=this.timer.innerText}resetTimer(){this.timerVal=null,this.startTimer()}pauseGame(){if(!this.isPaused)return this.isPaused=!0,this.setTimerVal(),clearInterval(this.timerID),void console.log("paused");this.isPaused=!1,this.startTimer()}setStyleSheet(){if(null!==this.styleSheet)return;const t=document.styleSheets;for(let e=0,s=t.length;e<s;e++)for(let s=0,i=t[e].cssRules.length;s<i;s++)".main-container"===t[e].cssRules[s].selectorText&&(this.styleSheet=t[e])}setClassRule(t,e){this.styleSheet.insertRule(`${t}{${e}}`,this.styleSheet.cssRules.length)}changeCSSClass(t,e,s,i){const o=document.getElementById(t);o.classList.remove(e+s),o.classList.add(e+i)}makeAllParts(){this.mainContainer||(this.el=this.createElNode("div","mainContainer","main-container pos"),this.setClassRule(".pos",`top: calc(50% - ${this.getBackGroundSize()}px/2); left: calc(50% - ${this.getBackGroundSize()}px/2);`),this.appendToMain(this.el),this.mainContainer=document.getElementById("mainContainer")),this.makeAllObj(),this.matrix.forEach((t=>{this.setClassRule(".cube-position"+t.ownNum,""+this.getElLeftTopCSSProp(t.ownNum)),this.setClassRule(".cube-bg"+t.ownNum,this.getElCSS(t.ownNum)),this.innerEl=document.createElement("div"),this.innerEl.id="elID_"+t.ownNum,this.innerEl.dataset.elNum=t.ownNum,this.innerEl.classList=`cube-position${t.ownNum} cube-bg${t.ownNum}`,this.innerEl.textContent=t.ownNum,this.mainContainer.appendChild(this.innerEl)}))}createElNode(t,e="",s="",i="",o="",n=""){const h=document.createElement(t);return""!==e&&(h.id=e),""!==o&&(h.dataset[o]=n),""!==s&&(h.classList=s),""!==i&&(h.textContent=i),h}appendToMain(t){this.mainEl||(this.mainEl=document.getElementById("main")),this.mainEl.appendChild(t)}makeDimensionSelect(){const t=this.createElNode("select","dimSelect","selects");Object.keys(this.isMobile?this.dem.mobile:this.dem.desktop).forEach((e=>{this.el=this.createElNode("option","","",`${e}x${e}`,"dim",e),e.toString()===this.defaultDimension.toString()&&(this.el.selected=!0),t.appendChild(this.el)})),this.sattingsBoardContainer.appendChild(t)}makeImagesSelect(){const t=this.createElNode("select","imgSelect","selects");for(let e=1;e<=this.img.imagesAmount;e++)this.el=this.createElNode("option","","","image "+e,"dim",e),t.appendChild(this.el);this.sattingsBoardContainer.appendChild(t)}makeHeader(){this.appendToMain(this.createElNode("h1","","",this.string[this.lang].gemPuzzle))}makeResetBtn(){this.gameBoardContainer.appendChild(this.createElNode("div","resetBtn","btn centered",this.string[this.lang].resetBtn))}makeGameDashBoard(){this.appendToMain(this.createElNode("div","dashBoardContainer","dash dash-pos"));const t=this.getBackGroundSize();this.setClassRule(".dash-pos",`width: ${t}px; left: calc(50% - ${t}px/2); top: calc(50% - ${t-(t>320?180:120)}px);`),this.dashBoardContainer=document.getElementById("dashBoardContainer")}makeSettingsDash(){this.appendToMain(this.createElNode("div","sattingsBoardContainer","dash sattings-board-container")),this.sattingsBoardContainer=document.getElementById("sattingsBoardContainer")}makeGameDash(){this.appendToMain(this.createElNode("div","gameBoardContainer","dash sattings-board-container game-top-mod")),this.gameBoardContainer=document.getElementById("gameBoardContainer")}makeTimer(){this.dashBoardContainer.appendChild(this.createElNode("div","timer","centered","00:00:00")),this.timer=document.getElementById("timer")}makeStopStartTimerBtn(){this.dashBoardContainer.appendChild(this.createElNode("div","stopStartBtn","btn centered",this.string[this.lang].startBtn)),this.stopStartBtn=document.getElementById("stopStartBtn")}makeStepNumber(){this.dashBoardContainer.appendChild(this.createElNode("div","steps","centered",this.string[this.lang].step+"0")),this.stepCounterObj=document.getElementById("steps")}makeSaveBtn(){this.gameBoardContainer.appendChild(this.createElNode("div","saveBtn","btn centered",this.string[this.lang].saveBtn))}makeLoadBtn(){this.gameBoardContainer.appendChild(this.createElNode("div","loadBtn","btn centered",this.string[this.lang].loadBtn))}bestResBtn(){this.gameBoardContainer.appendChild(this.createElNode("div","bestResBtn","btn centered",this.string[this.lang].bestResBtn)),this.bestResBtnObj=document.getElementById("bestResBtn")}makeIsSolvingHint(){this.appendToMain(this.createElNode("div","solvingHint","solving-hint centered")),this.solvingHint=document.getElementById("solvingHint")}makeIsWinHint(){this.appendToMain(this.createElNode("div","winHint","win-hint centered")),this.winHint=document.getElementById("winHint")}makeSoundBtn(){this.sattingsBoardContainer.appendChild(this.createElNode("div","soundBtn","btn centered",this.string[this.lang].soundBtn)),this.soundBtn=document.getElementById("soundBtn")}makeSoundField(){const t=this.createElNode("audio","sound1","sound-1");t.src="sounds/sound1.wav",this.appendToMain(t),this.soundObj=document.getElementById("sound1")}makeAIStepBtn(){this.dashBoardContainer.appendChild(this.createElNode("div","stepBtn","btn centered",this.string[this.lang].stepBtn)),this.stepBtn=document.getElementById("stepBtn")}getClassRule(t){for(let e=0,s=this.styleSheet.cssRules.length;e<s;e++)if(this.styleSheet.cssRules[e].selectorText===t)return this.styleSheet.cssRules[e];return!1}getElCSS(t){const e=t===this.getMatrixDimension()?"z-index: 0; opacity: 0;":"z-index: 1; opacity: 1;";return`${this.getElBgPosCSSProp(t)} width: ${this.getOffset()}px; height: ${this.getOffset()}px; line-height: ${this.getOffset()}px; ${e}`}makeNoMatrixElmnts(){this.makeHeader(),this.makeSettingsDash(),this.makeDimensionSelect(),this.makeImagesSelect(),this.makeSoundBtn(),this.makeSoundField(),this.makeGameDash(),this.makeResetBtn(),this.makeSaveBtn(),this.makeLoadBtn(),this.bestResBtn(),this.makeGameDashBoard(),this.makeTimer(),this.startTimer(),this.makeStopStartTimerBtn(),this.makeStepNumber(),this.makeAIStepBtn(),this.makeIsSolvingHint(),this.makeIsWinHint()}showMatrix(){this.makeAllParts(),this.shuffle(),this.dragElementInit()}setAllPartsInItsPos(){let t;this.matrix.forEach(((e,s)=>{t=document.getElementById("elID_"+(s+1)),this.setPosX(s+1,this.getXPXPosition(s+1)),this.setPosY(s+1,this.getYPXPosition(s+1)),t.className="wbrdr box-text-color cube-bg"+(s+1),t.classList.add("cube-position"+(s+1))}))}isPairEven(t,e){for(let s=t,i=this.shuffledMatrix.length;s<i;s++)e>this.shuffledMatrix[s]&&e!==this.getMatrixDimension()&&(this.shuffledMatrixEvenSumm+=1,this.tempLog=`${this.tempLog}${e} > ${this.shuffledMatrix[s]}\n`)}isShuffledMatrixSolving(){return this.shuffledMatrixEvenSumm=0,this.shuffledMatrix.forEach(((t,e)=>{this.isPairEven(e,t),this.tempLog=""})),this.getMatrixDimension()%2==0?(this.shuffledMatrixEvenSumm=this.shuffledMatrixEvenSumm+this.matrix[this.getMatrixDimension()-1].y/this.getOffset()+1,this.shuffledMatrixEvenSumm%2==0):this.shuffledMatrixEvenSumm%2==0}shuffle(t=!1){this.shuffledMatrix.forEach(((t,e)=>{this.shuffleFnMakeStep(t,e+1)})),this.setClassRule(".cube-bg"+this.getMatrixDimension(),"opacity: 0;"),t||(this.isShuffledMatrixSolving()||(this.resetShuffledMatrix(),console.log("notsolving"),this.shuffle()),this.winHint.innerText="")}shuffleFnMakeStep(t,e){const s=document.getElementById("elID_"+t);s.className="wbrdr box-text-color cube-bg"+t,s.classList.add("cube-position"+e),this.setPosX(t,this.getXPXPosition(e)),this.setPosY(t,this.getYPXPosition(e))}resetShuffledMatrix(){this.shuffledMatrix=[],this.makeShuffledMatrix(),this.winHint.innerText=""}getCurrentElNum(t){return parseInt(this.getPosX(t)/this.getOffset(),10)+1+parseInt(this.getPosY(t)/this.getOffset(),10)*this.matrixDimensionY}getRightCurrentElNum(t){return parseInt((this.getPosX(t)+this.getOffset())/this.getOffset(),10)+1+parseInt(this.getPosY(t)/this.getOffset(),10)*this.matrixDimensionY}getLeftCurrentElNum(t){return parseInt((this.getPosX(t)-this.getOffset())/this.getOffset(),10)+1+parseInt(this.getPosY(t)/this.getOffset(),10)*this.matrixDimensionY}getBottomCurrentElNum(t){return parseInt(this.getPosX(t)/this.getOffset(),10)+1+parseInt((this.getPosY(t)+this.getOffset())/this.getOffset(),10)*this.matrixDimensionY}getTopCurrentElNum(t){return parseInt(this.getPosX(t)/this.getOffset(),10)+1+parseInt((this.getPosY(t)-this.getOffset())/this.getOffset(),10)*this.matrixDimensionY}changDrgblClass(t,e,s,i){this.changeCSSClass(t,e,s,i),this.changeCSSClass(this.getMainElID(),e,i,s)}changeObPosVal(t){const e=this.getPosX(this.getMatrixDimension()),s=this.getPosY(this.getMatrixDimension());this.setPosX(this.getMatrixDimension(),this.getPosX(t)),this.setPosY(this.getMatrixDimension(),this.getPosY(t)),this.setPosX(t,e),this.setPosY(t,s),"win"===this.isUserWin()&&(this.winHint.innerText=`You win! for ${this.step} steps and ${document.getElementById("timer").innerText}`,this.setClassRule(".cube-bg"+this.getMatrixDimension(),"opacity: 1;"),document.getElementById(this.getMainElID()).classList.add("animated"),document.querySelectorAll("[data-el-num]").forEach((t=>{t.classList.remove("box-text-color"),t.classList.add("box-text-color-trnsprnt"),t.classList.remove("wbrdr")})),this.isPaused=!0,clearInterval(this.timerID))}isElOnPropPosX(t){return this.matrix[t-1].x===this.getXPXPosition(t)}isElOnPropPosY(t){return this.matrix[t-1].y===this.getYPXPosition(t)}isElOnPropPos(t){return this.isElOnPropPosX(t)&&this.isElOnPropPosY(t)}isUserWin(){if(this.isElOnPropPos(this.getMatrixDimension())){for(let t=0,e=this.matrix.length;t<e;t++)if(!this.isElOnPropPos(t+1))return!1;return"win"}return!1}clearSteps(){this.step=0,this.stepCounterObj.innerText=this.string[this.lang].step+"0"}changeStepCountNum(){this.step+=1,this.stepCounterObj.innerText=`${this.string[this.lang].step}${this.step}`}dragElementInit(){}mainUsrController(){const t=this;document.onclick=function(e){if("resetBtn"===e.target.id)return t.resetShuffledMatrix(),t.setAllPartsInItsPos(),t.shuffle(),clearInterval(t.timerID),t.resetTimer(),void t.clearSteps();if("soundBtn"===e.target.id)return t.soundBtn.innerText=t.isSound?t.string[t.lang].soundBtnOFF:t.string[t.lang].soundBtn,t.isSound=!t.isSound,void console.log("sound");if("stepBtn"===e.target.id)return t.isAutoMode=!t.isAutoMode,void(t.isAutoMode&&t.makeAISteps());if("saveBtn"===e.target.id)return void console.log("save");if("loadBtn"===e.target.id)return void console.log("load");if("loadBtn"===e.target.id)return void console.log("load");if("bestResBtn"===e.target.id)return void console.log("best Result Btn");if("stopStartBtn"===e.target.id)return t.stopStartBtn.innerText=t.isPaused?t.string[t.lang].stopBtn:t.string[t.lang].startBtn,void t.pauseGame();if(!e.target.dataset.elNum)return;const s=e.target.dataset.elNum,i=t.getCurrentElNum(s);if(!t.isPaused){if(t.isDrggblToTop(s)){t.changeStepCountNum();const o=t.getTopCurrentElNum(s);return t.changDrgblClass(e.target.id,"cube-position",i,o),t.changeObPosVal(s),void(t.isSound&&t.soundObj.play())}if(t.isDrggblToBottom(s)){t.changeStepCountNum();const o=t.getBottomCurrentElNum(s);return t.changDrgblClass(e.target.id,"cube-position",i,o),t.changeObPosVal(s),void(t.isSound&&t.soundObj.play())}if(t.isDrggblToRight(s)){t.changeStepCountNum();const o=t.getRightCurrentElNum(s);return t.changDrgblClass(e.target.id,"cube-position",i,o),t.changeObPosVal(s),void(t.isSound&&t.soundObj.play())}if(t.isDrggblToLeft(s)){t.changeStepCountNum();const o=t.getLeftCurrentElNum(s);t.changDrgblClass(e.target.id,"cube-position",i,o),t.changeObPosVal(s),t.isSound&&t.soundObj.play()}}},document.onchange=function(e){"dimSelect"===e.target.id&&(clearInterval(t.timerID),t.resetTimer(),t.clearSteps(),t.setDimentionXY(e.target.options[e.target.selectedIndex].dataset.dim),t.setMainElNum(),t.setOffset(),t.mainContainer.innerHTML="",t.araseMatrix(),t.resetShuffledMatrix(),t.setAllPartsInItsPos(),t.showMatrix(),t.shuffle()),"imgSelect"===e.target.id&&t.setClassRule(".main-container div",`background-image: url('../images/${e.target.options[e.target.selectedIndex].dataset.dim}.jpg');`)},window.onresize=function(){const e=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth;e<480?(console.log(e),t.isMobile=!0,t.setOffset()):t.isMobile&&(t.isMobile=!1,t.setOffset())}}};document.addEventListener("DOMContentLoaded",(()=>{t.render()}))})();